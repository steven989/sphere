
<script>
var addConnectionJSVar;
var test;
$(function(){
    $('#canvas').bubblify(<%= raw @raw_bubbles_data %>,<%= raw @bubbles_parameters %>)
    $('#addConnection').off('click').on('click',function(){
         addConnectionJSVar = vex.dialog.open({
            input: [
            '<button class="btn" style="width:100%; margin-bottom:5px; background-color:#3b5998; color:white;">Import from Facebook</button>',
            '<br>',
            '<button class="btn btn-blue" style="width:100%; margin-bottom:10px; background-color:#0077b5; color:white;">Import from LinkedIn</button>',
            '<h2 style="width:100%;text-align:center;border-bottom:1px solid #E0E0E0;line-height:0.34em;margin:10px 0 20px;"><span style="font-size:13px;color:#787878;background-color:#f0f0f0;padding:0 19px;font-weight:bold;">Or enter manually</span></h2>',
            '<div class="vex-custom-field-wrapper">',
                '<div class="vex-custom-input-wrapper">',
                    '<input name="name" type="text" placeholder="Name" required>',
                '</div>',
                '<div class="vex-custom-input-wrapper">',
                    '<input name="email" type="text" placeholder="Email">',
                '</div>',
                '<div class="vex-custom-input-wrapper">',
                    '<input name="phone" type="text" placeholder="Phone">',
                '</div>',
                '<div class="vex-custom-input-wrapper">',
                    '<input name="target_contact_interval_in_days" type="number" placeholder="How often to reach out? (days)" required>',
                '</div>',
            '</div>',
            '<div class="alert hidden" id="connectionFormAlert" style="margin-top:1px;line-height:10px;"></div>'
            ].join(''),
            buttons: [
                $.extend({}, vex.dialog.buttons.YES, { text: 'Add' }),
                $.extend({}, vex.dialog.buttons.NO, { text: 'Cancel' })
            ],            
            onSubmit: function(data){
                event.preventDefault();
                event.stopPropagation();
              $.ajax({
                url: '<%= create_connection_path %>',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({name:$('input[name="name"]')[0].value,email:$('input[name="email"]')[0].value,phone:$('input[name="phone"]')[0].value,target_contact_interval_in_days:$('input[name="target_contact_interval_in_days"]')[0].value}),
                dataType: 'JSON'
              }).done(function(data){
                if (data.status) {
                    $("#connectionFormAlert").html(data.message).removeClass("alert-danger").removeClass("alert-success").addClass("alert-success").removeClass("hidden");
                    setTimeout(function(){
                        $("#connectionFormAlert").addClass('hidden');
                        $('input[name="name"]')[0].value = "";
                        $('input[name="phone"]')[0].value = "";
                        $('input[name="email"]')[0].value = "";
                        $('input[name="target_contact_interval_in_days"]')[0].value = "";
                    },2000)
                } else {
                    $("#connectionFormAlert").html(data.message).removeClass("alert-danger").removeClass("alert-success").addClass("alert-danger").removeClass("hidden");
                    
                }
              })
            }
        });
    })
})
</script>
<div id="profile">
    <div id="logo">
        Sphere Beta
    </div>
    <div id="addConnection">
        Add
    </div>
    <div id="accountSettings">
        Settings
    </div>
</div>

<div id="topTabs-container-home">
    <div class="topTabs-header clearfix">
        <ul class="etabs tabs" id="navigation">
            <li class="tab"><a href="#mySphere">MY SPHERE</a></li>
            <li class="tab"><a href="#challenges">CHALLENGES</a></li>
            <li class="tab"><a href="#progress">PROGRESS</a></li>
            <li class="tab"><a href="#achievements">ACHIEVEMENTS</a></li>
        </ul>        
    </div> 
    <div class="topTabsContent">
        <div id="mySphere">

            <div id="canvas" style="background:gray; width:600px; height:600px; position: relative;"></div>

            <h3>Connections</h3>
            <%= link_to 'Create Connection', new_connection_path %>
            <table border=1>
                <thead>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Add Activity</th>
                    <th>Add Note</th>
                </thead>
                <tbody>
                    <% @connections.each do |connection| %>
                        <tr>
                            <td><%= connection.first_name %></td>
                            <td><%= connection.last_name %></td>
                            <td><%= link_to 'Add', new_activity_path(connection) %></td>
                            <td><%= form_tag create_connection_note_path(connection), method: 'POST' do %><%= text_field_tag :notes %><%= submit_tag "Note" %><% end %></td>
                        </tr>
                    <% end %>
                </tbody>
            </table>

            
            
            
        </div>
        <div id="challenges"></div>
        <div id="progress"></div>
        <div id="achievements"></div>
    </div>
</div>



<%= link_to 'Logout', logout_path %>